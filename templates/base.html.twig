<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title id="title">{% block title %}{% endblock %}</title>
        <link rel="icon" type="image/x-icon" href="{{ asset('favicon/PPTfavicon.ico') }}">

        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
        {% endblock %}
    </head>
    <body>
        {% set currentUserId      = app.user.id %}
        {% set notificationsTopic = 'notifications' ~ currentUserId %}
        <div class="container-shadow bg-dark">
            <div class="container">
                <nav class="navbar navbar-expand-lg navbar-dark">

                    <a class="navbar-brand fw-bold fs-1" href="{{ path('app_home') }}">
                        <span>P</span><small class="fs-6 fw-lighter">(rivate)</small><span>P</span><small class="fs-6 fw-lighter">(ublic)</small><span>T</span><small class="fs-6 fw-lighter">(exting)</small>
                    </a>

                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav ms-auto me-2">
                            <li class="nav-item">
                                <a class="nav-link" href="{{ path('app_home') }}">chats</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ path('app_chat_groups') }}">group chats</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ path('app_friends_list') }}">friends</a>
                            </li>
                            <li class="nav-item me-2">
                                <a class="nav-link" href="{{ path('app_search_users') }}">search friends</a>
                            </li>
                            <li class="nav-item my-auto">
                                <div class="dropdown user-dropdown-menu">
                                    <a href="#" class="text-decoration-none d-flex align-items-center text-light" id="userDropDownMenu" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <i class="bi bi-person-lines-fill bi-user-icon me-2"></i>
                                        <span>{{ app.user.username }}</span>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end dropstart bg-light" aria-labelledby="userDropDownMenu">
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                notifications
                                                <span class="badge rounded-pill bg-primary px-3 py-2 ms-3">
                                                    {{ app.user.receivedNotifications | length }}
                                                </span>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{{ path('app_friends_requests') }}">
                                                friend requests
                                                <span class="badge rounded-pill bg-primary px-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-down" viewBox="0 0 16 16">
                                                        <path d="M12.5 9a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7m.354 5.854 1.5-1.5a.5.5 0 0 0-.708-.708l-.646.647V10.5a.5.5 0 0 0-1 0v2.793l-.646-.647a.5.5 0 0 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                                                        <path d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4"/>
                                                    </svg> {{ app.user.receivedFriendRequests | length }}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-up" viewBox="0 0 16 16">
                                                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.354-5.854 1.5 1.5a.5.5 0 0 1-.708.708L13 11.707V14.5a.5.5 0 0 1-1 0v-2.793l-.646.647a.5.5 0 0 1-.708-.708l1.5-1.5a.5.5 0 0 1 .708 0M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                                                        <path d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4"/>
                                                    </svg> {{ app.user.sentFriendRequests | length }}
                                                </span>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">settings</a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <form action="{{ path('app_logout') }}" method="post">
                                                <input type="hidden" name="_csrf_token" value="{{ csrf_token('logout') }}">
                                                <button class="dropdown-item" href="#">log out</button>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        {% include '_flashes.html.twig' %}
        {% include '_reloadModal.html.twig' %}
        {% block body %}{% endblock %}

        {% if topics is not defined %}
            {% set topics = [] %} {# setting array of topics to subscibe within authorization cookie #}
        {% endif %}
        {% set topics = topics|Push(notificationsTopic) %}

        <script type="application/json" id="mercure-notifications-url">
            {{ mercure(notificationsTopic, { subscribe: topics })|json_encode(constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_HEX_TAG'))|raw  }}
        </script>
    </body>
    <footer class="mt-5 container-shadow">
    </footer>
</html>

